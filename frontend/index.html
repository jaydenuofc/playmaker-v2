<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fantasy Start/Sit Helper ‚Äì V2</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #0A1A2F;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f7f7f7;
    }

    .app {
      background: #ffffff;
      color: #1c2430;
      max-width: 1000px;
      width: 95%;
      padding: 24px 24px 24px;
      border-radius: 12px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.3);
    }

    .app-header {
      text-align: center;
      margin-bottom: 18px;
      position: relative; /* needed so logo can sit in top-left */
    }

    /* Logo container in top-left of header */
    .app-logo {
      position: absolute;
      left: 0;
      top: 0;
    }

    .app-logo img {
      height: 40px;   /* adjust if you want bigger/smaller */
      width: auto;
      border-radius: 8px; /* optional rounded corners */
    }

    .app-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .app-subtitle {
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .howto-box {
      margin-top: 10px;
      display: inline-block;
      text-align: left;
      background: #eff6ff;
      color: #1f2937;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #bfdbfe;
      font-size: 0.78rem;
      max-width: 460px;
    }

    .howto-box strong {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: #1d4ed8;
    }

    .howto-box ul {
      padding-left: 16px;
      list-style: disc;
    }

    .howto-box li + li {
      margin-top: 2px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 16px 0 10px;
    }

    button {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      background: #0A1A2F;
      color: #ffffff;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
      background: #122946;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    button.secondary:hover {
      background: #d1d5db;
    }

    button.danger {
      background: #fee2e2;
      color: #b91c1c;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    button.danger:hover {
      background: #fecaca;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 16px;
      margin-top: 10px;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: #f9fafb;
      border-radius: 10px;
      padding: 12px 12px 8px;
      border: 1px solid #e5e7eb;
    }

    .panel-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #374151;
    }

    .panel-title span {
      font-size: 0.75rem;
      font-weight: 500;
      color: #6b7280;
    }

    .player-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .player-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-radius: 8px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      font-size: 0.85rem;
    }

    /* Highlight invalid starters (too many at a position) */
    .player-card.invalid-starter {
      border-color: #fca5a5;
      background: #fef2f2;
    }

    .player-main {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .player-initial {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: #0A1A2F;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .player-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .player-name {
      font-weight: 600;
    }

    .player-meta {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .player-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-pill {
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      border: 1px solid transparent;
    }

    .status-green { background: #ecfdf5; color:#047857; border-color:#bbf7d0; }
    .status-amber { background: #fffbeb; color:#b45309; border-color:#fed7aa; }
    .status-red   { background: #fef2f2; color:#b91c1c; border-color:#fecaca; }

    .panel.recommend {
      background: #0f172a;
      color: #e5e7eb;
      border-color: #1e293b;
      grid-column: span 2;
    }

    @media (max-width: 768px) {
      .panel.recommend {
        grid-column: span 1;
      }
    }

    .panel.recommend .panel-title {
      color: #e5e7eb;
    }

    .panel.recommend .panel-title span {
      color: #9ca3af;
    }

    .recommend-body {
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .recommend-note {
      color: #9ca3af;
      font-size: 0.7rem;
      margin-top: 6px;
    }

    .recommend-line {
      padding: 6px 8px;
      border-radius: 6px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid #1e293b;
    }

    .recommend-line strong {
      color: #e5e7eb;
    }

    .recommend-tag {
      font-size: 0.7rem;
      color: #93c5fd;
      margin-left: 4px;
    }

    .legend {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 6px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.72rem;
      color: #6b7280;
    }

    .legend-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }

    .legend-green {
      background: #00D97E;
    }

    .legend-amber {
      background: #FFC145;
    }

    .legend-red {
      background: #FF4D4D;
    }

    .risk-summary {
      margin: 4px auto 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f1f5f9;
      border: 1px solid #e5e7eb;
      font-size: 0.78rem;
      color: #334155;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .risk-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      display: inline-block;
    }

    .risk-dot.green { background: #22c55e; }
    .risk-dot.yellow { background: #facc15; }
    .risk-dot.red { background: #ef4444; }

    .lineup-error {
      margin: 4px auto 4px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      font-size: 0.78rem;
      color: #b91c1c;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .lineup-error.hidden {
      display: none;
    }

    .edit-roster {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 0.8rem;
    }

    .edit-roster-title {
      font-weight: 600;
      margin-bottom: 6px;
      color: #374151;
    }

    .edit-roster-form {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .edit-roster-form input,
    .edit-roster-form select {
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.78rem;
      min-width: 120px;
    }

    .edit-roster small {
      display: block;
      margin-top: 4px;
      color: #6b7280;
      font-size: 0.7rem;
    }

    footer {
      margin-top: 10px;
      text-align: center;
      font-size: 0.7rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="app-logo">
        <img src="logo.png" alt="PlayMaker logo" />
      </div>

      <div class="app-title">Fantasy Start/Sit Helper ‚Äì V2</div>
      <div class="app-subtitle">
        Green = start, amber = be careful, red = sit (injury-based).
      </div>
      <div class="legend">
        <div class="legend-item">
          <span class="legend-dot legend-green"></span><span>Healthy</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot legend-amber"></span><span>Questionable</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot legend-red"></span><span>Out / IR</span>
        </div>
      </div>
      <div class="howto-box">
        <strong>How to use this app</strong>
        <ul>
          <li>Move players between <em>Starters</em> and <em>Bench</em> with the ‚ÄúMove‚Äù button.</li>
          <li>Click <em>Update injury status from backend</em> to pull live injury data.</li>
          <li>Use the color dots, risk summary, and lineup format check to decide who to start or sit.</li>
        </ul>
      </div>
    </header>

    <section class="controls">
      <button id="fetchFromEspn">Update injury status from backend</button>
      <button class="secondary" id="resetData">Reset to default lineup</button>
    </section>

    <section style="text-align:center;">
      <div id="riskSummary" class="risk-summary">
        Loading risk summary‚Ä¶
      </div>
      <div id="lineupError" class="lineup-error hidden"></div>
    </section>

    <section class="layout">
      <div class="panel">
        <div class="panel-title">
          Starters
          <span>Must match: 1 DST, 1 QB, 2 WR, 2 RB, 1 TE, 2 FLEX, 1 K</span>
        </div>
        <div id="startersList" class="player-list"></div>
      </div>

      <div class="panel">
        <div class="panel-title">
          Bench
          <span>Click ‚ÄúMove‚Äù to send to starters</span>
        </div>
        <div id="benchList" class="player-list"></div>
      </div>

      <div class="panel recommend">
        <div class="panel-title">
          Start/Sit Recommendations
          <span class="badge">Injury-based only</span>
        </div>
        <div id="recommendations" class="recommend-body"></div>
        <div class="recommend-note">
          This uses live injury data from your backend powered by the Sleeper API.
        </div>
      </div>
    </section>

    <section class="edit-roster">
      <div class="edit-roster-title">Edit Roster (V2 feature)</div>
      <div class="edit-roster-form">
        <input id="newPlayerName" type="text" placeholder="Player name (e.g. Tank Dell)" />
        <input id="newPlayerTeam" type="text" placeholder="Team (e.g. HOU)" />
        <select id="newPlayerPosition">
          <option value="WR">WR</option>
          <option value="RB">RB</option>
          <option value="QB">QB</option>
          <option value="TE">TE</option>
          <option value="FLEX">FLEX</option>
          <option value="DST">DST</option>
          <option value="K">K</option>
        </select>
        <button id="addPlayerBtn">Add to Bench</button>
      </div>
      <small>Added players start on the bench with a healthy status. You can move them to starters or delete them.</small>
    </section>

    <footer>
      PlayMaker V2 ¬∑ ENTI 633 ¬∑ Lineup + injury helper
    </footer>
  </div>

  <script>
    const API_BASE = "https://playmaker-v2-backend.onrender.com";
    const STORAGE_KEY = "playmaker_v2_players";

    // Starter position limits
    const STARTER_LIMITS = {
      DST: 1,
      QB: 1,
      WR: 2,
      RB: 2,
      TE: 1,
      FLEX: 2,
      K: 1
    };

    /********************
     * Default roster   *
     ********************/
    const defaultPlayers = [
      { id: 1,  name: "Jacksonville Defense", position: "DST",  team: "JAX", status: "healthy", isStarter: true },
      { id: 2,  name: "Jalen Hurts",          position: "QB",   team: "PHI", status: "healthy", isStarter: true },
      { id: 3,  name: "Puka Nacua",           position: "WR",   team: "LAR", status: "healthy", isStarter: true },
      { id: 4,  name: "George Pickens",       position: "WR",   team: "PIT", status: "healthy", isStarter: true },
      { id: 5,  name: "Bijan Robinson",       position: "RB",   team: "ATL", status: "healthy", isStarter: true },
      { id: 6,  name: "Jaylen Warren",        position: "RB",   team: "PIT", status: "healthy", isStarter: true },
      { id: 7,  name: "Jake Ferguson",        position: "TE",   team: "DAL", status: "healthy", isStarter: true },
      { id: 8,  name: "Zach Charbonnet",      position: "FLEX", team: "SEA", status: "healthy", isStarter: true },
      { id: 9,  name: "Kenneth Gainwell",     position: "FLEX", team: "PHI", status: "healthy", isStarter: true },
      { id: 10, name: "Chris Boswell",        position: "K",    team: "PIT", status: "healthy", isStarter: true },

      { id: 11, name: "Bucky Irving",         position: "RB",   team: "TB",  status: "healthy", isStarter: false },
      { id: 12, name: "Mark Andrews",         position: "TE",   team: "BAL", status: "healthy", isStarter: false },
      { id: 13, name: "Michael Pittman Jr",   position: "WR",   team: "IND", status: "healthy", isStarter: false },
      { id: 14, name: "J.K. Dobbins",         position: "RB",   team: "LAC", status: "healthy", isStarter: false },
      { id: 15, name: "Jared Goff",           position: "QB",   team: "DET", status: "healthy", isStarter: false },
      { id: 16, name: "J.J. McCarthy",        position: "QB",   team: "MIN", status: "healthy", isStarter: false },
      { id: 17, name: "Travis Hunter",        position: "WR",   team: "JAX", status: "healthy", isStarter: false }
    ];

    let players = [];

    const statusToCss = {
      healthy: "status-green",
      questionable: "status-amber",
      out: "status-red"
    };

    const statusLabel = {
      healthy: "Green ¬∑ Good to play",
      questionable: "Amber ¬∑ Questionable",
      out: "Red ¬∑ Out / IR"
    };

    const startersList = document.getElementById("startersList");
    const benchList = document.getElementById("benchList");
    const recommendationsContainer = document.getElementById("recommendations");
    const riskSummaryEl = document.getElementById("riskSummary");
    const lineupErrorEl = document.getElementById("lineupError");

    function cloneDefaultPlayers() {
      return JSON.parse(JSON.stringify(defaultPlayers));
    }

    /***************
     * LocalStorage *
     ***************/
    function savePlayers() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
      } catch (e) {
        console.warn("Could not save to localStorage", e);
      }
    }

    function loadPlayers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return null;
        return parsed;
      } catch (e) {
        console.warn("Could not read from localStorage", e);
        return null;
      }
    }

    function getInitials(name) {
      return name
        .split(" ")
        .filter(Boolean)
        .slice(0, 2)
        .map(part => part[0].toUpperCase())
        .join("");
    }

    function getLineupValidation() {
      const starters = players.filter(p => p.isStarter);
      const counts = {};
      starters.forEach(p => {
        counts[p.position] = (counts[p.position] || 0) + 1;
      });

      const invalidPositions = new Set();
      const problems = [];

      Object.keys(STARTER_LIMITS).forEach(pos => {
        const limit = STARTER_LIMITS[pos];
        const count = counts[pos] || 0;
        if (count > limit) {
          invalidPositions.add(pos);
          problems.push(`${pos} (${count}/${limit})`);
        }
      });

      return { counts, invalidPositions, problems };
    }

    function renderPlayers() {
      startersList.innerHTML = "";
      benchList.innerHTML = "";

      const { invalidPositions, problems } = getLineupValidation();

      players.forEach(player => {
        const card = document.createElement("div");
        card.className = "player-card";

        if (player.isStarter && invalidPositions.has(player.position)) {
          card.classList.add("invalid-starter");
        }

        const main = document.createElement("div");
        main.className = "player-main";

        const initial = document.createElement("div");
        initial.className = "player-initial";
        initial.textContent = getInitials(player.name);

        const textWrap = document.createElement("div");
        textWrap.className = "player-text";

        const nameEl = document.createElement("div");
        nameEl.className = "player-name";
        nameEl.textContent = player.name;

        const metaEl = document.createElement("div");
        metaEl.className = "player-meta";
        metaEl.textContent = `${player.position} ¬∑ ${player.team}`;

        textWrap.appendChild(nameEl);
        textWrap.appendChild(metaEl);

        main.appendChild(initial);
        main.appendChild(textWrap);

        const right = document.createElement("div");
        right.className = "player-right";

        const status = document.createElement("div");
        status.className = `status-pill ${statusToCss[player.status] || ""}`;
        status.textContent = statusLabel[player.status] || "Status unknown";

        const moveBtn = document.createElement("button");
        moveBtn.textContent = player.isStarter ? "Move to Bench" : "Move to Starters";
        moveBtn.classList.add("secondary");
        moveBtn.style.fontSize = "0.7rem";
        moveBtn.onclick = () => toggleStarter(player.id);

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete";
        deleteBtn.classList.add("danger");
        deleteBtn.onclick = () => deletePlayer(player.id);

        right.appendChild(status);
        right.appendChild(moveBtn);
        right.appendChild(deleteBtn);

        card.appendChild(main);
        card.appendChild(right);

        if (player.isStarter) {
          startersList.appendChild(card);
        } else {
          benchList.appendChild(card);
        }
      });

      if (problems.length === 0) {
        lineupErrorEl.textContent = "";
        lineupErrorEl.classList.add("hidden");
      } else {
        lineupErrorEl.textContent =
          "Lineup error: too many starters at " + problems.join(", ") +
          ". Allowed format is 1 DST, 1 QB, 2 WR, 2 RB, 1 TE, 2 FLEX, 1 K.";
        lineupErrorEl.classList.remove("hidden");
      }

      renderRecommendations();
      renderRiskSummary();
    }

    function renderRecommendations() {
      recommendationsContainer.innerHTML = "";

      const starters = players.filter(p => p.isStarter);
      const bench = players.filter(p => !p.isStarter);

      const lines = [];

      starters.forEach(starter => {
        // Only consider injured starters (yellow or red)
        if (starter.status === "healthy") return;

        // Bench players must be healthy and same position (or valid FLEX)
        const healthyBench = bench.filter(b =>
          b.status === "healthy" &&
          (
            b.position === starter.position ||
            (starter.position === "FLEX" && ["RB", "WR", "TE"].includes(b.position))
          )
        );

        if (!healthyBench.length) return;

        const benchPlayer = healthyBench[0];
        const severity = starter.status === "out" ? "HIGH" : "MEDIUM";

        lines.push({ starter, benchPlayer, severity });
      });

      if (!lines.length) {
        const ok = document.createElement("div");
        ok.className = "recommend-line";
        ok.innerHTML = "<strong>Your current lineup looks good based on injury status.</strong>";
        recommendationsContainer.appendChild(ok);
        return;
      }

      lines.sort((a, b) => {
        const sevScore = s => (s.severity === "HIGH" ? 0 : 1);
        return sevScore(a) - sevScore(b);
      });

      lines.forEach(line => {
        const row = document.createElement("div");
        row.className = "recommend-line";

        const severityTag = line.severity === "HIGH"
          ? "üö® Strong injury risk"
          : "‚ö†Ô∏è Consider swapping";

        row.innerHTML = `
          <strong>${line.starter.name}</strong> (${line.starter.position}, ${line.starter.team}) is 
          <span class="recommend-tag">${statusLabel[line.starter.status]}</span>.
          <br />
          You could start <strong>${line.benchPlayer.name}</strong> (${line.benchPlayer.position}, ${line.benchPlayer.team}) instead
          ‚Äî they are <span class="recommend-tag">${statusLabel["healthy"]}</span>.
          <br />
          <span style="font-size:0.72rem; color:#9ca3af;">${severityTag}</span>
        `;
        recommendationsContainer.appendChild(row);
      });
    }

    function renderRiskSummary() {
      const starters = players.filter(p => p.isStarter);

      let healthy = 0, questionable = 0, out = 0;
      starters.forEach(p => {
        if (p.status === "healthy") healthy++;
        else if (p.status === "questionable") questionable++;
        else if (p.status === "out") out++;
      });

      riskSummaryEl.innerHTML = `
        <span><strong>Starters risk summary:</strong></span>
        <span><span class="risk-dot green"></span> ${healthy} healthy</span>
        <span><span class="risk-dot yellow"></span> ${questionable} questionable</span>
        <span><span class="risk-dot red"></span> ${out} out / IR</span>
      `;
    }

    function toggleStarter(id) {
      players = players.map(p =>
        p.id === id ? { ...p, isStarter: !p.isStarter } : p
      );
      savePlayers();
      renderPlayers();
    }

    function deletePlayer(id) {
      if (!confirm("Remove this player from your roster?")) return;
      players = players.filter(p => p.id !== id);
      savePlayers();
      renderPlayers();
    }

    function getNextId() {
      if (!players.length) return 1;
      return Math.max(...players.map(p => p.id)) + 1;
    }

    function handleAddPlayer() {
      const nameInput = document.getElementById("newPlayerName");
      const teamInput = document.getElementById("newPlayerTeam");
      const posSelect = document.getElementById("newPlayerPosition");

      const name = nameInput.value.trim();
      const team = teamInput.value.trim().toUpperCase();
      const position = posSelect.value;

      if (!name) {
        alert("Please enter a player name.");
        return;
      }

      const newPlayer = {
        id: getNextId(),
        name,
        position,
        team: team || "FA",
        status: "healthy",
        isStarter: false
      };

      players.push(newPlayer);
      savePlayers();
      renderPlayers();

      nameInput.value = "";
      teamInput.value = "";
      posSelect.value = "WR";
    }

    async function fetchFromEspnApi() {
      try {
        const names = players.map(p => p.name);
        const namesParam = encodeURIComponent(names.join(","));

        const res = await fetch(`${API_BASE}/api/player-status?names=${namesParam}`);

        if (!res.ok) {
          throw new Error(`Backend error: ${res.status} ${res.statusText}`);
        }

        const apiData = await res.json();

        players = players.map(p => {
          const match = apiData.find(a =>
            a.name.toLowerCase().includes(p.name.toLowerCase())
          );

          if (!match) return p;

          let newStatus = "healthy";
          if (match.color === "yellow") newStatus = "questionable";
          if (match.color === "red") newStatus = "out";

          return { ...p, status: newStatus };
        });

        savePlayers();
        renderPlayers();
      } catch (err) {
        console.error(err);
        alert("Could not load live injuries. Using local statuses only.");
      }
    }

    function resetToDefault() {
      if (!confirm("Reset lineup to default and clear saved changes?")) return;
      players = cloneDefaultPlayers();
      savePlayers();
      renderPlayers();
    }

    function init() {
      const loaded = loadPlayers();
      if (loaded && Array.isArray(loaded) && loaded.length) {
        players = loaded;
      } else {
        players = cloneDefaultPlayers();
      }

      renderPlayers();

      document.getElementById("fetchFromEspn").addEventListener("click", fetchFromEspnApi);
      document.getElementById("resetData").addEventListener("click", resetToDefault);
      document.getElementById("addPlayerBtn").addEventListener("click", (e) => {
        e.preventDefault();
        handleAddPlayer();
      });
    }

    init();
  </script>
</body>
</html>


